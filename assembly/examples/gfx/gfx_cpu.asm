jmpa $MAIN

@MACRO(@GPU_DEVICE, (), 0x0004)

@INCLUDE("assembly/std/arithmetic.asm")
@INCLUDE("assembly/std/procedure.asm")

@INCLUDE("assembly/std/gpu/cpu.asm")

@MACRO(@SEND_GPU_DATA, (@DATA),
    @STORE(@DATA, @NULLPTR)
    @WAIT_GPU_STATE(@GPU_STATE_READY)
)

@MACRO(@SEND_TOP_GPU_DATA, (),
    @TOP_STORE(@NULLPTR)
    @WAIT_GPU_STATE(@GPU_STATE_READY)
)

@MACRO(@GPU_SWAP_BUFFERS, (),
    @SEND_GPU_DATA(@GPU_STATE_SWAP_BUFFERS)
)


@MACRO(@SEND_ROW, (@ADR, @VALUE1, @VALUE2),
    @SEND_GPU_DATA(@GPU_STATE_MODE_0)
        push @VALUE1
        @SEND_TOP_GPU_DATA
        pop

        push @VALUE2
        @SEND_TOP_GPU_DATA
        pop

        push @ADR
        @SEND_TOP_GPU_DATA
        pop
)

$MAIN:
    device @GPU_DEVICE

    @SEND_ROW(0x0001, 0b1100000000000000, 0b0000000000000011)
    @GPU_SWAP_BUFFERS

    @SEND_ROW(0x0002, 0b1111000000000000, 0b0000000000001111)
    @GPU_SWAP_BUFFERS

    @SEND_ROW(0x0003, 0b1111110000000000, 0b0000000000111111)
    @GPU_SWAP_BUFFERS

    @SEND_ROW(0x0004, 0b1111111100000000, 0b0000000011111111)
    @GPU_SWAP_BUFFERS

    @SEND_ROW(0x0005, 0b1111111111000000, 0b0000001111111111)
    @GPU_SWAP_BUFFERS

    halt